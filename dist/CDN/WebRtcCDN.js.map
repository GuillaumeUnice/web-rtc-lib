{"version":3,"sources":["webpack:///webpack/bootstrap 82f2d979a921fe52e28b","webpack:///./src/index.ts","webpack:///./src/WebRTCLib.ts","webpack:///./~/ws-jms-lib-echyzen/dist/index.js","webpack:///./~/ws-jms-lib-echyzen/dist/WsJMSLib.js"],"names":[],"mappings":"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","file":"WebRtcCDN.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n// WEBPACK FOOTER //\n// webpack/bootstrap 82f2d979a921fe52e28b","/// <reference path=\"../typings/index.d.ts\" />\n/// <reference path=\"./Temasys.d.ts\" />\n\nexport {WebRTCLib} from './WebRTCLib';\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./src/index.ts","import {wsJmsLib} from 'ws-jms-lib-echyzen';\n\n// var test = new WebRTCLib('ws://yourserveraddress:8001', 'myTopic', 'userID');\n\n// test.createStream({\"video\": true, \"audio\":false}, function(stream){\n//   // get local stream for manipulation\n//   let local = document.getElementById('localVideo');\n//   WebRTCLib.attachStream(stream, local);\n// } , function(stream){\n//   // get local stream for manipulation\n//   let local = document.getElementById('localVideo');\n//   WebRTCLib.attachStream(stream, local);\n// });\n\n\n// class ConfigWebRTC {\n//   constructor(public url: string, public channelID: string, public userID: string) { };\n  \n//   static RESPONSE = \"response_web_rtc\";\n//   static REQUEST = \"request_web_rtc\"; \n//   static ICE_CANDIDATE = \"ice_candidate_web_rtc\";\n// }\n\nexport class WebRTCLib {\n\n  // private myCConfigWebRTC: ConfigWebRTC;\n\n  private myRTCPeerConnection: RTCPeerConnection;\n  private wsJmsLib: wsJmsLib\n\n  private tempRemoteDesc: RTCSessionDescriptionInit;\n  private listTempRemoteIceCandidate: RTCIceCandidate[];\n\n\tconstructor(private url: string, private channelID: string, private userID: string) {\n    \n    this.myRTCPeerConnection = this.getBrowserRTCConnectionObj();\n    this.wsJmsLib = new wsJmsLib();\n\n    this.wsJmsLib.connect(url, () => {\n      this.wsJmsLib.subscribe(channelID, this.dispatchMessage);\n    });  \n  }\n\n  private dispatchMessage(message: any): void {\n    switch (message.type) {\n      case 'request_web_rtc':\n        if(this.userID !== message.user_id)\n          this.tempRemoteDesc = message;\n        break;\n    \n      case 'ice_candidate_web_rtc':\n        if(this.userID !== message.user_id)\n          this.listTempRemoteIceCandidate.push(message.message);\n        break;\n\n      case 'response_web_rtc':\n        if(this.userID !== message.user_id)\n          this.responseWebRTC(message.message);\n        break;\n\n      default:\n        break;\n    }\n    \n  }\n\n  private responseWebRTC(remoteDesc: RTCSessionDescriptionInit) {\n    this.myRTCPeerConnection.setRemoteDescription(new RTCSessionDescription(remoteDesc));\n  }\n\n  private getBrowserRTCConnectionObj () {\n    let servers: RTCConfiguration = null;\n    let constraints: RTCMediaConstraints = {\n      'optional': []\n    };\n    if (window.mozRTCPeerConnection) {\n      return new mozRTCPeerConnection(servers, constraints);\n    } else if (window.webkitRTCPeerConnection) {\n        return new webkitRTCPeerConnection(servers, constraints);\n    } else {\n      return new RTCPeerConnection(servers, constraints);\n    }\n  }\n\n  private buildMessage(message: any, type: string) {\n    return {\n      chatroom_id: this.channelID,\n      user_id: this.userID,\n      type: type,\n      message: message\n    }\n  }\n\n  private sendIceCandidates(myRTCIceCandidateEvent: RTCIceCandidateEvent): void {\n    if (myRTCIceCandidateEvent.candidate) {\n      let lightRTCIceCandidateEvent = {\n        sdpMid: myRTCIceCandidateEvent.candidate.sdpMid,\n        sdpMLineIndex: myRTCIceCandidateEvent.candidate.sdpMLineIndex,\n        candidate: myRTCIceCandidateEvent.candidate.candidate\n      }\n      let message = this.buildMessage(lightRTCIceCandidateEvent, 'ice_candidate_web_rtc');\n      this.wsJmsLib.send(JSON.stringify(message), this.channelID, () => {});\n    }\n  }\n\n  private getDescription(myDesc: RTCSessionDescription) {\n    this.myRTCPeerConnection.setLocalDescription(myDesc,\n      () => {\n      this.listTempRemoteIceCandidate.forEach((remoteIceCandidate: RTCIceCandidate) => {\n        this.myRTCPeerConnection.addIceCandidate(new RTCIceCandidate(remoteIceCandidate));\n      });\n\n      let message = this.buildMessage(myDesc, 'response_web_rtc');\n      this.wsJmsLib.send(JSON.stringify(message), this.channelID, () => {});\n    });\n  }\n\n  ////////////////////////////////////////////////////////////////\n\tpublic createStream(userMediaStream: MediaStreamConstraints,\n    getLocalStream: (stream: MediaStream) => any,\n    getRemoteStream: (stream: MediaStream) => any) {\n\n    navigator.getUserMedia(userMediaStream, function(myStream) {\n\n\t\t\t\tthis.myRTCPeerConnection.addStream(myStream);\n        getLocalStream(myStream);\n\n\t\t\t\tthis.myRTCPeerConnection.onicecandidate = this.sendIceCandidates;\n\n\t\t\t\tthis.myRTCPeerConnection.onaddstream = (evt: RTCMediaStreamEvent) => {\n          getRemoteStream(evt.stream);\n        }\n\n        // This condition determine if you are the WebRTC's receiver or not\n        if(this.tempRemoteDesc) {\n          this.myRTCPeerConnection.setRemoteDescription(\n            new RTCSessionDescription(this.tempRemoteDesc),\n            function() {\n              this.myRTCPeerConnection.createAnswer(\n                this.gettDescription, \n                (err: Error) => console.error(err));\n          }, (err: Error) => console.error(err));\n        } else {\n          \tthis.myRTCPeerConnection.createOffer( (myDesc: RTCSessionDescription) => {\n            \n            this.myRTCPeerConnection.setLocalDescription(myDesc);\n            let message = this.buildMessage(myDesc, 'request_web_rtc');\n            this.wsJmsLib.send(JSON.stringify(message), this.channelID, () => {});\n          },(err: Error) => { console.error(err) });\n        }\n\t\t\n\t\t\t}, (err: Error) => console.error(err));\n\n\t}\n\n  static attachStream(mediaStream: MediaStream, HTMLElement: HTMLElement) {\n    HTMLElement = attachMediaStream(HTMLElement, mediaStream);\n  }\n\n}\n\n\n\n// WEBPACK FOOTER //\n// ./~/tslint-loader!./src/WebRTCLib.ts","var WsJMSLib_1 = require('./WsJMSLib');\nexports.wsJmsLib = WsJMSLib_1.wsJmsLib;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/ws-jms-lib-echyzen/dist/index.js\n// module id = 3\n// module chunks = 0","/// <reference path=\"./wsJMSKaazing.d.ts\" />\nvar wsJmsLib = (function () {\n    //////////////////////////////////////////////////////////////////////////////////\n    function wsJmsLib() {\n        this.connection = {};\n        this.session = {};\n        this.consumers = {};\n    }\n    wsJmsLib.prototype.createDestination = function (name) {\n        var reTopic = new RegExp(wsJmsLib.baseTopicUrl, 'i');\n        var reQueue = new RegExp(wsJmsLib.baseQueueUrl, 'i');\n        if (name.match(reTopic)) {\n            return this.session.createTopic(name);\n        }\n        else if (name.match(reQueue)) {\n            return this.session.createQueue(name);\n        }\n        else {\n            throw new Error(\"Destination must start with /topic/ or /queue/\");\n        }\n    };\n    wsJmsLib.prototype.buildMessage = function (message) {\n        var textMessage = this.session.createTextMessage(message);\n        return textMessage;\n    };\n    //////////////////////////////////////////////////////////////////////////////////\n    wsJmsLib.prototype.connect = function (url, callback) {\n        var connectionFactory = new JmsConnectionFactory(url);\n        var that = this;\n        var connectionFuture = connectionFactory.createConnection(function () {\n            try {\n                that.connection = connectionFuture.getValue();\n            }\n            catch (err) {\n                console.error(err);\n            }\n            that.session = that.connection.createSession(false, Session.AUTO_ACKNOWLEDGE);\n            that.connection.start(function () {\n                callback();\n            });\n        });\n    };\n    ;\n    wsJmsLib.prototype.subscribe = function (channelName, messageListener) {\n        var _this = this;\n        // assuming connection has already been established and started\n        // ideally we need to maintain the state of the connection and throw error\n        // if the controller calls subscribe before connection is established\n        // or after the connection is closed\n        var topic = this.session.createTopic(channelName);\n        var consumer = this.session.createConsumer(topic);\n        this.consumers[channelName] = consumer;\n        consumer.setMessageListener(function (message) {\n            messageListener.call(_this, message.getText());\n        });\n    };\n    ;\n    wsJmsLib.prototype.send = function (message, topic, callback) {\n        var dest = this.createDestination(topic);\n        var producer = this.session.createProducer(dest);\n        var textMessage = this.buildMessage(message);\n        try {\n            var future = producer.send(textMessage, function () {\n                if (future.exception) {\n                    console.error(future.exception);\n                }\n                callback();\n            });\n        }\n        catch (e) {\n            console.error(e);\n        }\n        producer.close();\n    };\n    wsJmsLib.prototype.unsubscribe = function (channelName, callback) {\n        var consumer = this.consumers[channelName];\n        if (consumer) {\n            delete this.consumers[channelName];\n            consumer.close(callback);\n        }\n    };\n    ;\n    wsJmsLib.baseTopicUrl = 'topic';\n    wsJmsLib.baseQueueUrl = 'queue';\n    return wsJmsLib;\n})();\nexports.wsJmsLib = wsJmsLib;\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./~/ws-jms-lib-echyzen/dist/WsJMSLib.js\n// module id = 4\n// module chunks = 0"],"sourceRoot":""}