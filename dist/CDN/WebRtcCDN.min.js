var WebRtcCDN=function(e){function t(s){if(n[s])return n[s].exports;var i=n[s]={exports:{},id:s,loaded:!1};return e[s].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){e.exports=n(2)},function(e,t,n){"use strict";var s=n(4),i=function(){function e(e,t,n){var i=this;this.url=e,this.channelID=t,this.userID=n,this.myRTCPeerConnection=this.getBrowserRTCConnectionObj(),this.wsJmsLib=new s.wsJmsLib,this.wsJmsLib.connect(e,function(){i.wsJmsLib.subscribe(t,i.dispatchMessage)})}return e.prototype.dispatchMessage=function(e){var t=this;switch(e=JSON.parse(e),console.log("dispatchMessage",e),e.type){case"request_web_rtc":this.userID!==e.user_id&&(console.log("request_web_rtc",e),this.myRTCPeerConnection.setRemoteDescription(new RTCSessionDescription(this.tempRemoteDesc),function(){t.myRTCPeerConnection.createAnswer(t.getDescription,function(e){return console.error(e)})},function(e){return console.error(e)}),this.tempRemoteDesc=e);break;case"ice_candidate_web_rtc":this.userID!==e.user_id&&(console.log("ice_candidate_web_rtc",e),this.listTempRemoteIceCandidate.push(e.message));break;case"response_web_rtc":this.userID!==e.user_id&&(console.log("response_web_rtc",e),this.responseWebRTC(e.message))}},e.prototype.responseWebRTC=function(e){this.myRTCPeerConnection.setRemoteDescription(new RTCSessionDescription(e))},e.prototype.getBrowserRTCConnectionObj=function(){var e=null,t={optional:[]};return window.mozRTCPeerConnection?new mozRTCPeerConnection(e,t):window.webkitRTCPeerConnection?new webkitRTCPeerConnection(e,t):new RTCPeerConnection(e,t)},e.prototype.buildMessage=function(e,t){return{chatroom_id:this.channelID,user_id:this.userID,type:t,message:e}},e.prototype.sendIceCandidates=function(e){if(e.candidate){var t={sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex,candidate:e.candidate.candidate},n=this.buildMessage(t,"ice_candidate_web_rtc");this.wsJmsLib.send(JSON.stringify(n),this.channelID,function(){})}},e.prototype.getDescription=function(e){var t=this;this.myRTCPeerConnection.setLocalDescription(e,function(){t.listTempRemoteIceCandidate.forEach(function(e){t.myRTCPeerConnection.addIceCandidate(new RTCIceCandidate(e))});var n=t.buildMessage(e,"response_web_rtc");t.wsJmsLib.send(JSON.stringify(n),t.channelID,function(){})})},e.prototype.createStream=function(e,t,n){var s=this;navigator.getUserMedia(e,function(e){s.myRTCPeerConnection.addStream(e),t(e),s.myRTCPeerConnection.onicecandidate=function(e){s.sendIceCandidates(e)},s.myRTCPeerConnection.onaddstream=function(e){n(e.stream)},s.tempRemoteDesc||s.myRTCPeerConnection.createOffer(function(e){s.myRTCPeerConnection.setLocalDescription(e);var t=s.buildMessage(e,"request_web_rtc");s.wsJmsLib.send(JSON.stringify(t),s.channelID,function(){})},function(e){console.error(e)})},function(e){return console.error(e)})},e.attachStream=function(e,t){t=attachMediaStream(t,e)},e}();t.WebRTCLib=i},function(e,t,n){"use strict";var s=n(1);t.WebRTCLib=s.WebRTCLib},function(e,t){"use strict";var n=function(){function e(){this.connection={},this.session={},this.consumers={}}return e.prototype.createDestination=function(t){var n=new RegExp(e.baseTopicUrl,"i"),s=new RegExp(e.baseQueueUrl,"i");if(t.match(n))return this.session.createTopic(t);if(t.match(s))return this.session.createQueue(t);throw new Error("Destination must start with /topic/ or /queue/")},e.prototype.buildMessage=function(e){var t=this.session.createTextMessage(e);return t},e.prototype.connect=function(e,t){var n=new JmsConnectionFactory(e),s=this,i=n.createConnection(function(){try{s.connection=i.getValue()}catch(e){console.error(e)}s.session=s.connection.createSession(!1,Session.AUTO_ACKNOWLEDGE),s.connection.start(function(){t()})})},e.prototype.subscribe=function(e,t){var n=this,s=this.session.createTopic(e),i=this.session.createConsumer(s);this.consumers[e]=i,i.setMessageListener(function(e){t.call(n,e.getText())})},e.prototype.send=function(e,t,n){var s=this.createDestination(t),i=this.session.createProducer(s),o=this.buildMessage(e);try{var r=i.send(o,function(){r.exception&&console.error(r.exception),n()})}catch(e){console.error(e)}i.close()},e.prototype.unsubscribe=function(e,t){var n=this.consumers[e];n&&(delete this.consumers[e],n.close(t))},e.baseTopicUrl="topic",e.baseQueueUrl="queue",e}();t.wsJmsLib=n},function(e,t,n){"use strict";var s=n(3);t.wsJmsLib=s.wsJmsLib}]);
//# sourceMappingURL=WebRtcCDN.min.js.map